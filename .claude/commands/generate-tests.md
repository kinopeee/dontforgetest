# テストコード生成スキル

テストコードを生成・追加・更新する際のワークフロー。

## 対象

- 新機能のテスト作成
- バグ修正に対するテスト追加
- 既存テストの更新
- テストカバレッジ向上

## ワークフロー

以下の手順に従ってテストコードを生成する。

### Step 1: 対象コードの理解

1. テスト対象のソースコードを読み込む
2. 関数/メソッドの入出力、分岐、エラーケースを把握する
3. 既存のテストがあれば確認する

### Step 2: テスト観点表の作成

テストコード実装前に、Markdown形式の「テスト観点表」を作成して提示する。

#### 必須列

| Case ID | Input / Precondition | Perspective (Equivalence / Boundary) | Expected Result | Notes |
|---------|----------------------|--------------------------------------|-----------------|-------|
| TC-N-01 | 有効な入力 | Equivalence – normal | 処理成功 | - |
| TC-A-01 | NULL | Boundary – NULL | バリデーションエラー | - |

#### Case ID 命名規則

| プレフィックス | 意味 |
|---------------|------|
| TC-N-XX | 正常系 (Normal) |
| TC-A-XX | 異常系 (Abnormal) |
| TC-B-XX | 境界値 (Boundary) |
| TC-E-XX | 例外 (Exception) |

#### 網羅すべきケース

- **正常系**: 主要シナリオ
- **異常系**: バリデーションエラー、例外パス
- **境界値**: 0, 最小値, 最大値, ±1, 空, NULL
- **不正な型・形式**の入力
- **外部依存の失敗**（API / DB 等）

境界値候補のうち仕様上意味を持たないものは Notes に理由を記載し省略可。

### Step 3: テストコード実装

#### 実装ポリシー

1. テスト観点表のケースを**すべて**自動化テストとして実装
2. **正常系と同数以上の失敗系**を含める
3. 分岐網羅率 100% を目標（達成困難な場合はビジネスインパクトの高い分岐を優先）
4. 未カバー分岐がある場合は理由と影響を Notes や PR 本文に明示

#### Given / When / Then コメント

各テストケースに以下のコメントを必ず付与する：

```typescript
// TC-N-01: テストケースの説明
// Given: 前提条件
// When:  実行する操作
// Then:  期待する結果/検証
```

#### 例外・エラー検証

- 例外の**型**と**メッセージ**を明示的に検証
- バリデーション系ではエラーコード・フィールド情報も確認
- 外部依存失敗はスタブ/モックで模擬

### Step 4: 実行・確認

1. テストを実行して全テストがパスすることを確認
2. 可能であればカバレッジを確認

```bash
# このプロジェクトのテストコマンド
npm test
```

## テストコード例（TypeScript）

```typescript
suite('対象モジュール名', () => {
  // TC-N-01: 有効な入力で正常に処理される
  test('TC-N-01: should process valid input successfully', () => {
    // Given: 有効な入力
    const input = { ... };

    // When: 処理を実行
    const result = targetFunction(input);

    // Then: 期待する結果
    assert.strictEqual(result, expectedValue);
  });

  // TC-A-01: NULLでバリデーションエラー
  test('TC-A-01: should throw validation error when input is null', () => {
    // Given: nullの入力
    const input = null;

    // When/Then: バリデーションエラーがスローされる
    assert.throws(() => targetFunction(input), TypeError);
  });
});
```

## 運用ルール

- 本ルールに適合しないテストはレビューで差し戻し対象
- 外部依存がなくてもモックで失敗系をテスト
- 仕様変更時はテスト観点表とテストコードを同時更新
- 自動化困難なケースは理由と代替手段を明記しレビュアと合意

## 適用除外

既存テストの軽微な修正（メッセージ調整、期待値微修正）で新しい分岐や制約が追加されない場合は、テスト観点表の作成・更新は任意。
